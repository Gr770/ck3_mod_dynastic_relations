
# Should be called when scoped to a character. Assumes that dynastic relation can be established
dr_establish_dynastic_relation_with_dynasty_of = {

    this = {

        set_variable = {
            name = dr_dynastic_relation_target
            value = $TARGET$
        }

        create_story = {
            type = dr_dynastic_relation
            # The other dynastyÂ´s story will just be a proxy to this one
            save_scope_as = is_proxy_of
        } 

    }

    $TARGET$ = {

        set_variable = {
            name = dr_dynastic_relation_target
            value = prev.this
        }

        set_variable = {
            name = dr_dynastic_relation_target_is_proxy_of
            value = scope:is_proxy_of
        }

        # This story will be just a proxy pointing to the one created above
        create_story = dr_dynastic_relation
    }
}

# Will save the dynastic relation "object" in the current scope (as scope:dynastic_relation) between characters $A$ and $B$ 
dr_save_dynastic_relation_between_characters_in_scope = {

    $A$.dynasty.var:dr_dynasty_relation_stories_holder = {
        random_owned_story = {

            limit = {
                story_type = dr_dynastic_relation
                var:target = $B$.dynasty 
            }

            if = {
                limit = {
                    exists = this.var:is_proxy_of
                }
                
                var:is_proxy_of = {
                    save_scope_as = dynastic_relation
                }
            }
            else = {
                save_scope_as = dynastic_relation
            }
            
        }
    }
}

dr_save_dynastic_relation_between_dynasties_in_scope = {

}

# Add/subtracts dynastic relation value. It expects the dynastic relation to be currently scoped.
# Use dr_save_dynastic_relation_between_characters_in_scope and dr_save_dynastic_relation_between_dynasties_in_scope to save dynastic relations in scope
dr_add_dynastic_relation_value = {

    change_variable = {
        name = value
        add = $VAL$
    }

}

# Decay dynastic relation towards the baseline
dr_decay_dynastic_relation_value = {

    if = {
        limit = {
            var:value < 0
        }

        change_variable = {
            name = value
            add = 1.0
            max = 0.0
        }
    }
    else = {
        change_variable = {
            name = value
            subtract = 1.0
            min = 0.0
        }
    }

}